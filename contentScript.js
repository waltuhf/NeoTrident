function e(){const e=document.querySelector('[id^="x-template-base-"]');e&&e.remove()}function t(e){e&&navigator.clipboard.writeText(e).then()}window.addEventListener("message",(e=>{if(e.source===window){const{msg:t,currentKey:n}=e.data;if(function(e){try{return JSON.parse(e),!0}catch(e){return!1}}(t))try{const e=JSON.parse(t);if(e?.connectionId)return void chrome.runtime.sendMessage({action:"setConnectionId",connectionId:e.connectionId})}catch(e){console.error("Failed to parse data from web app:",e)}if("pageReloaded"===t||"openNewTab"===t||"windowFocus"===t){const e="pageReloaded"===t?"pageReloaded":"openNewTab"===t?"openNewTab":"windowFocus",o={action:e,key:n};"openNewTab"===e&&(o.url="chrome://extensions/"),chrome.runtime.sendMessage(o)}}})),window.addEventListener("beforeunload",(()=>{e()})),chrome.runtime.onMessage.addListener((t=>{"getUrlAndExtensionData"===t.action?t.url&&function(t){e();const n=document.createElement("span");n.id=`x-template-base-${t.currentKey}`,document.body.appendChild(n),window.postMessage(t.enabledExtensionCount,t.url)}(t):"removeInjectedElement"===t.action?e():"invalid"===t.action&&function(e){window.postMessage(e,e.url)}(t)})),setInterval((()=>{localStorage.setItem("extensionActiveTime",Date.now())}),1e3),chrome.runtime.onMessage.addListener(((e,n,o)=>{switch(e.action){case"copy-text":t(e.text),o({status:"success",message:"Text copied!"});break;case"read-text":return navigator.clipboard.readText().then((e=>{o({clipboardContent:e})})),!0;case"paste_codeblock":return async function(e){try{!function(e){const t=document.activeElement;!t||"TEXTAREA"!==t.tagName&&"INPUT"!==t.tagName||(t.value=e)}(await navigator.clipboard.readText()),e({status:"success",message:"Content replaced in focused input/textarea!"})}catch(t){e({status:"error",message:"Failed to read clipboard content."})}}(o),!0;case"toggle-chat":s()}}));const n=document.createElement("div");n.id="chat-bubble",n.style.position="fixed",n.style.width="50px",n.style.height="50px",n.style.borderRadius="50%",n.style.backgroundColor="#007bff",n.style.bottom="20px",n.style.right="20px",n.style.cursor="pointer",n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.zIndex="10000",n.innerHTML="ðŸ’¬",document.body.appendChild(n);const o=document.createElement("textarea");function s(){"none"===o.style.display?a():i()}function a(){const e=n.getBoundingClientRect();let t=e.top-150-10,s=e.left;t<0&&(t=e.bottom+10),s+300>window.innerWidth&&(s=window.innerWidth-300-10),t<0&&(t=10),o.style.top=`${t}px`,o.style.left=`${s}px`,o.style.display="block",o.focus()}function i(){o.style.display="none",o.value=""}o.id="chat-textarea",o.placeholder="Type your message...",o.style.position="fixed",o.style.width="300px",o.style.height="150px",o.style.padding="10px",o.style.border="1px solid #ccc",o.style.borderRadius="5px",o.style.boxShadow="0 0 10px rgba(0,0,0,0.1)",o.style.display="none",o.style.zIndex="10001",o.style.resize="none",o.style.fontSize="14px",document.body.appendChild(o),n.addEventListener("click",(()=>{s()})),document.addEventListener("keydown",(e=>{e.altKey&&"t"===e.key.toLowerCase()&&(e.preventDefault(),s())})),o.addEventListener("keydown",(e=>{if("Enter"===e.key&&!e.shiftKey){e.preventDefault();const n=o.value.trim();n&&function(e){i(),document.body.style.cursor="wait",chrome.runtime.sendMessage({action:"chat-submit",content:e},(e=>{document.body.style.cursor="default",e&&e.response&&t(e.response)}))}(n)}})),function(e){let t,n,o=!1;e.addEventListener("mousedown",(s=>{o=!0,t=s.clientX-e.getBoundingClientRect().left,n=s.clientY-e.getBoundingClientRect().top,document.body.style.userSelect="none"})),document.addEventListener("mousemove",(s=>{if(o){let o=s.clientX-t,a=s.clientY-n;o=Math.max(0,Math.min(o,window.innerWidth-e.offsetWidth)),a=Math.max(0,Math.min(a,window.innerHeight-e.offsetHeight)),e.style.left=`${o}px`,e.style.top=`${a}px`,e.style.bottom="auto",e.style.right="auto"}})),document.addEventListener("mouseup",(()=>{o&&(o=!1,document.body.style.userSelect="auto")}))}(n),window.addEventListener("resize",(()=>{"block"===o.style.display&&a()}));new MutationObserver((()=>{"block"===o.style.display&&a()})).observe(n,{attributes:!0,attributeFilter:["style"]});
