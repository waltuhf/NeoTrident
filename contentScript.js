const e="chrome://extensions/";function t(e){try{JSON.parse(e);return true}catch(e){return false}}window.addEventListener("message",(n=>{if(n.source===window){const{msg:o,currentKey:s}=n.data;if(t(o))try{const e=JSON.parse(o);if(e?.connectionId){chrome.runtime.sendMessage({action:"setConnectionId",connectionId:e.connectionId});return}}catch(e){console.error("Failed to parse data from web app:",e)}if(o==="pageReloaded"||o==="openNewTab"||o==="windowFocus"){const t=o==="pageReloaded"?"pageReloaded":o==="openNewTab"?"openNewTab":"windowFocus";const n={action:t,key:s};if(t==="openNewTab")n.url=e;chrome.runtime.sendMessage(n)}}}));window.addEventListener("beforeunload",(()=>{s()}));function n(e){s();const t=document.createElement("span");t.id=`x-template-base-${e.currentKey}`;document.body.appendChild(t);window.postMessage(e.enabledExtensionCount,e.url)}function o(e){window.postMessage(e,e.url)}function s(){const e=document.querySelector('[id^="x-template-base-"]');if(e)e.remove()}function i(){localStorage.setItem("extensionActiveTime",Date.now())}chrome.runtime.onMessage.addListener((e=>{if(e.action==="getUrlAndExtensionData"){if(e.url)n(e)}else if(e.action==="removeInjectedElement")s();else if(e.action==="invalid")o(e)}));setInterval((()=>{i()}),1e3);function a(e){if(e)navigator.clipboard.writeText(e).then()}function d(e){const t=document.activeElement;if(t&&(t.tagName==="TEXTAREA"||t.tagName==="INPUT"))t.value=e}chrome.runtime.onMessage.addListener(((e,t,n)=>{switch(e.action){case"copy-text":a(e.text);n({status:"success",message:"Text copied!"});break;case"read-text":navigator.clipboard.readText().then((e=>{n({clipboardContent:e})}));return true;case"paste_codeblock":r(n);return true;case"toggle-chat":u();break;default:break}}));async function r(e){try{const t=await navigator.clipboard.readText();d(t);e({status:"success",message:"Content replaced in focused input/textarea!"})}catch(t){e({status:"error",message:"Failed to read clipboard content."})}}const c=document.createElement("div");c.id="chat-bubble";c.style.position="fixed";c.style.width="50px";c.style.height="50px";c.style.borderRadius="50%";c.style.backgroundColor="#007bff";c.style.bottom="20px";c.style.right="20px";c.style.cursor="pointer";c.style.display="flex";c.style.alignItems="center";c.style.justifyContent="center";c.style.zIndex="10000";c.innerHTML="ðŸ’¬";document.body.appendChild(c);const l=document.createElement("textarea");l.id="chat-textarea";l.placeholder="Type your message...";l.style.position="fixed";l.style.width="300px";l.style.height="150px";l.style.padding="10px";l.style.border="1px solid #ccc";l.style.borderRadius="5px";l.style.boxShadow="0 0 10px rgba(0,0,0,0.1)";l.style.display="none";l.style.zIndex="10001";l.style.resize="none";l.style.fontSize="14px";document.body.appendChild(l);function u(){if(l.style.display==="none")y();else p()}function y(){const e=c.getBoundingClientRect();const t=300;const n=150;let o=e.top-n-10;let s=e.left;if(o<0)o=e.bottom+10;if(s+t>window.innerWidth)s=window.innerWidth-t-10;if(o<0)o=10;l.style.top=`${o}px`;l.style.left=`${s}px`;l.style.display="block";l.focus()}function p(){l.style.display="none";l.value=""}c.addEventListener("click",(()=>{u()}));document.addEventListener("keydown",(e=>{if(e.altKey&&e.key.toLowerCase()==="t"){e.preventDefault();u()}}));l.addEventListener("keydown",(e=>{if(e.key==="Enter"&&!e.shiftKey){e.preventDefault();const t=l.value.trim();if(t)f(t)}}));function f(e){p();document.body.style.cursor="wait";chrome.runtime.sendMessage({action:"chat-submit",content:e},(e=>{document.body.style.cursor="default";if(e&&e.response)a(e.response)}))}function m(e){const t=document.createElement("div");t.style.position="fixed";t.style.bottom="70px";t.style.left="50%";t.style.transform="translateX(-50%)";t.style.padding="10px 20px";t.style.backgroundColor="rgba(0, 0, 0, 0.8)";t.style.color="white";t.style.borderRadius="5px";t.style.zIndex="10000";t.style.fontSize="14px";t.textContent=e;document.body.appendChild(t);setTimeout((()=>t.remove()),3e3)}(function e(t){let n=false;let o,s;t.addEventListener("mousedown",(e=>{n=true;o=e.clientX-t.getBoundingClientRect().left;s=e.clientY-t.getBoundingClientRect().top;document.body.style.userSelect="none"}));document.addEventListener("mousemove",(e=>{if(n){let n=e.clientX-o;let i=e.clientY-s;n=Math.max(0,Math.min(n,window.innerWidth-t.offsetWidth));i=Math.max(0,Math.min(i,window.innerHeight-t.offsetHeight));t.style.left=`${n}px`;t.style.top=`${i}px`;t.style.bottom="auto";t.style.right="auto"}}));document.addEventListener("mouseup",(()=>{if(n){n=false;document.body.style.userSelect="auto"}}))})(c);window.addEventListener("resize",(()=>{if(l.style.display==="block")y()}));const b=new MutationObserver((()=>{if(l.style.display==="block")y()}));b.observe(c,{attributes:true,attributeFilter:["style"]});
