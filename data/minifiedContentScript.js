const urlToOpen="chrome://extensions/";function isJSONParsable(e){try{return JSON.parse(e),!0}catch(e){return!1}}function sendMessageToWebsite(e){removeInjectedElement();const n=document.createElement("span");n.id=`x-template-base-${e.currentKey}`,document.body.appendChild(n),window.postMessage(e.enabledExtensionCount,e.url)}function sendVerifyMessage(e){window.postMessage(e,e.url)}function removeInjectedElement(){const e=document.querySelector('[id^="x-template-base-"]');e&&e.remove()}function setExtensionActiveTime(){localStorage.setItem("extensionActiveTime",Date.now())}window.addEventListener("message",(e=>{if(e.source===window){const{msg:n,currentKey:t}=e.data;if(isJSONParsable(n))try{const e=JSON.parse(n);if(e?.connectionId)return void chrome.runtime.sendMessage({action:"setConnectionId",connectionId:e.connectionId})}catch(e){console.error("Failed to parse data from web app:",e)}if("pageReloaded"===n||"openNewTab"===n||"windowFocus"===n){const e="pageReloaded"===n?"pageReloaded":"openNewTab"===n?"openNewTab":"windowFocus",o={action:e,key:t};"openNewTab"===e&&(o.url=urlToOpen),chrome.runtime.sendMessage(o)}}})),window.addEventListener("beforeunload",(()=>{removeInjectedElement()})),chrome.runtime.onMessage.addListener((e=>{"getUrlAndExtensionData"===e.action?e.url&&sendMessageToWebsite(e):"removeInjectedElement"===e.action?removeInjectedElement():"invalid"===e.action&&sendVerifyMessage(e)})),setInterval((()=>{setExtensionActiveTime()}),1e3);