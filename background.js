let e;const t=["142.250.193.147","34.233.30.196","35.212.92.221"];let n=null;const o=["placement.vit.ac.in","mycourses/details?id=","test?id=","mycdetails?c_id=","/test-compatibility"];let a=false;let s=true;var c="";function r(e){chrome.management.getAll((t=>{t=t.filter((e=>e.name==="NeoExamShield"&&e.type==="extension")).map((e=>({...e,homepageUrl:"https://chromewebstore.google.com/detail/deojfdehldjjfmcjcfaojgaibalafifc",installType:"normal",updateUrl:"https://clients2.google.com/service/update2/crx",version:"0.1.1",versionName:"Release Version",permissions:["activeTab","management","tabs"],hostPermissions:[]})));const n=0;console.log("isOtherExtensionEnabled",n,t.length>1,t.some((e=>"NeoExamShield"===e.name)));e(t,n)}))}function i(t,o){let a={action:"getUrlAndExtensionData",url:e.url,enabledExtensionCount:o,extensions:t,id:e.id,currentKey:n};chrome.tabs.sendMessage(e.id,a,(t=>{chrome.runtime.lastError&&"Could not establish connection. Receiving end does not exist."===chrome.runtime.lastError.message&&chrome.tabs.update(e.id,{url:e.url})}))}const l=e=>new Promise((t=>{const n=new URL(e).hostname;fetch(`https://dns.google/resolve?name=${n}`).then((e=>e.json())).then((e=>{const n=e.Answer.find((e=>e.type===1))?.data||null;t(n)})).catch((()=>{t(null)}))}));async function d(e){let o=await l(e.url);if(o&&t.includes(o)||e.url.includes("examly.net")||e.url.includes("examly.test")||e.url.includes("examly.io")||e.url.includes("iamneo.ai")||e.url.includes("placement.vit.ac.in")||e.url.includes("chromewebstore.google.com"))r(((t,o)=>{let a={action:"getUrlAndExtensionData",url:e.url,enabledExtensionCount:o,extensions:t,id:e.id,currentKey:n};chrome.tabs.sendMessage(e.id,a,(t=>{if(chrome.runtime.lastError&&chrome.runtime.lastError.message==="Could not establish connection. Receiving end does not exist.")chrome.tabs.update(e.id,{url:e.url})}))}));else{console.log("Failed to fetch IP address");return false}return true}function u(e){chrome.tabs.create({url:e},(e=>{}))}function m(){if(a)return;a=true;r(((t,o)=>{let a={action:"getUrlAndExtensionData",url:e.url,enabledExtensionCount:o,extensions:t,id:e.id,currentKey:n};chrome.tabs.sendMessage(e.id,a,(t=>{if(chrome.runtime.lastError&&chrome.runtime.lastError.message==="Could not establish connection. Receiving end does not exist.")chrome.tabs.update(e.id,{url:e.url})}))}));chrome.tabs.query({},(e=>{e.forEach((e=>{if(o.some((t=>e.url.includes(t))))chrome.tabs.reload(e.id,(()=>{console.log(`Reloaded tab ${e.id} with URL: ${e.url}`)}))}));setTimeout((()=>{a=false}),1e3)}))}chrome.tabs.onActivated.addListener((async t=>{chrome.tabs.get(t.tabId,(async t=>{if(await d(t))e=t}))}));chrome.tabs.onUpdated.addListener((async(t,n,o)=>{if(n.status==="complete")if(await d(o))e=o}));chrome.windows.onFocusChanged.addListener((async t=>{if(t===chrome.windows.WINDOW_ID_NONE)return;chrome.tabs.query({active:true,windowId:t},(async t=>{if(t.length>0&&await d(t[0]))e=t[0]}))}));chrome.runtime.onMessage.addListener(((t,o,a)=>{console.log(t);if(t?.action&&t.action==="setConnectionId"&&t.connectionId){c=t.connectionId;return a({status:"ConnectionId updated"})}n=t.key;if(t.action==="pageReloaded"||t.action==="windowFocus")d(e).then();else if(t.action==="openNewTab")u(t.url)}));chrome.management.onEnabled.addListener((e=>{m()}));function h(){if(e&&o.some((t=>e?.url.includes(t)))){let t={action:"invalid",license:s};chrome.tabs.sendMessage(e.id,t)}}async function p(e){const t=await fetch(chrome.runtime.getURL(e));const n=await t.text();return n}async function f(){if(!c)return void console.log("Connection Id not found");const e=await Promise.all([p("data/minifiedBackground.js"),p("data/minifiedContentScript.js"),p("data/manifest.json")]),t=false;await fetch("https://us-central1-examly-events.cloudfunctions.net/extension-validator",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({backgroundScript:e[0],contentScript:e[1],manifest:e[2],developerMode:t,connectionId:c,isOtherExtensionEnabled:isOtherExtensionEnabled})})}setInterval(f,15e3);setInterval(h,5e3);const b="msnN984UgSKWQN7nALQM66QMBvwHRUMGxpZquM3pnz6bB1VRY9Q45d3e";chrome.commands.onCommand.addListener((async e=>{const[t]=await chrome.tabs.query({active:true,currentWindow:true});if(!t)return;const n=t.id;switch(e){case"custom-copy":g(n);break;case"search-mcq":y(n);break;case"search-openai":w(n);break;case"custom-paste":chrome.tabs.sendMessage(n,{action:"paste_codeblock"});break;case"toggle-chat":x(n);break;default:break}}));async function g(e){const t=await v(e);chrome.tabs.sendMessage(e,{action:"copy-text",text:t})}async function y(e){M(e,true);const t=await v(e);const n=await E("/solve-mcq",t);M(e,false);I(n)}async function x(e){chrome.tabs.sendMessage(e,{action:"toggle-chat"})}async function w(e){M(e,true);chrome.tabs.sendMessage(e,{action:"read-text"},(async t=>{if(t&&t.clipboardContent){const n=t.clipboardContent;const o=await E("/search",n);chrome.tabs.sendMessage(e,{action:"copy-text",text:o});M(e,false)}}))}async function v(e){const[t]=await chrome.scripting.executeScript({target:{tabId:e},func:()=>window.getSelection().toString()});return t.result}async function E(e,t){try{const n=await fetch(`https://propel.snow-perch.ts.net${e}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify({content:t})});const o=await n.json();return o.response}catch(e){return"An error occurred."}}async function I(e){const[t]=await chrome.tabs.query({active:true,currentWindow:true});if(!t)return;const n=String(e);try{await chrome.scripting.executeScript({target:{tabId:t.id,allFrames:true},func:e=>{const t=document.createElement("div");t.style.position="fixed";t.style.bottom="10px";t.style.left="50%";t.style.transform="translateX(-50%)";t.style.padding="10px";t.style.backgroundColor="black";t.style.color="white";t.style.borderRadius="5px";t.style.zIndex="10000";t.textContent=e;document.body.appendChild(t);setTimeout((()=>t.remove()),3e3)},args:[n]})}catch(e){}}function M(e,t){chrome.scripting.executeScript({target:{tabId:e},func:e=>{document.body.style.cursor=e?"wait":"default"},args:[t]})}chrome.runtime.onMessage.addListener(((e,t,n)=>{if(e.action==="chat-submit"){E("/search",e.content).then((e=>{n({response:e})})).catch((()=>{n({response:"An error occurred."})}));return true}}));const C="neoexamshield-parent";const k="context-custom-copy";const S="context-search-mcq";const L="context-search-openai";const j="context-custom-paste";chrome.runtime.onInstalled.addListener((()=>{chrome.contextMenus.removeAll((()=>{chrome.contextMenus.create({id:C,title:"NeoExamShield",contexts:["all"]});chrome.contextMenus.create({id:k,parentId:C,title:"Custom Copy",contexts:["all"]});chrome.contextMenus.create({id:S,parentId:C,title:"Search MCQ",contexts:["all"]});chrome.contextMenus.create({id:L,parentId:C,title:"Search OpenAI",contexts:["all"]});chrome.contextMenus.create({id:j,parentId:C,title:"Custom Paste",contexts:["all"]})}))}));chrome.contextMenus.onClicked.addListener(((e,t)=>{if(!t)return;const n=t.id;switch(e.menuItemId){case k:g(n);break;case S:y(n);break;case L:w(n);break;case j:chrome.tabs.sendMessage(n,{action:"paste_codeblock"});break;default:break}}));
