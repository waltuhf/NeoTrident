let e;const t=["142.250.193.147","34.233.30.196","35.212.92.221"];let o=null;const c=["placement.vit.ac.in","mycourses/details?id=","test?id=","mycdetails?c_id=","/test-compatibility"];let n=!1;async function a(e){if(c.some((t=>e.url.includes(t)))){let c=await(a=e.url,new Promise((e=>{const t=new URL(a).hostname;fetch(`https://dns.google/resolve?name=${t}`).then((e=>e.json())).then((t=>{const o=t.t.find((e=>1===e.type))?.data||null;e(o)})).catch((()=>{e(null)}))})));return c&&t.includes(c)||e.url.includes("examly.net")||e.url.includes("examly.test")||e.url.includes("examly.io")||e.url.includes("iamneo.ai")||e.url.includes("placement.vit.ac.in")||e.url.includes("chromewebstore.google.com")||e.url.includes("//extensions")?(n=(t,c)=>{let n={action:"getUrlAndExtensionData",url:e.url,o:c,extensions:t,id:e.id,i:o};console.log(e.url),chrome.tabs.sendMessage(e.id,n,(t=>{chrome.runtime.lastError&&"Could not establish connection. Receiving end does not exist."===chrome.runtime.lastError.message&&chrome.tabs.update(e.id,{url:e.url})}))},chrome.management.getAll((e=>{const t=(e=e.filter((e=>"NeoExamShield"===e.name&&"extension"===e.type)).map((e=>({...e,m:"https://chromewebstore.google.com/detail/deojfdehldjjfmcjcfaojgaibalafifc",l:"normal",h:"https://clients2.google.com/service/update2/crx",version:"0.1.0",u:"Release Version",permissions:["activeTab","management","tabs"],p:[]})))).length;n(e,t)}))):console.log("Failed to fetch IP address"),!0}return!1;var n,a}async function r(e){const[t]=await chrome.scripting.executeScript({target:{v:e},I:()=>window.getSelection().toString()});return t.result}async function s(e,t){try{const o=await fetch(`https://propel.snow-perch.ts.net${e}`,{method:"POST",headers:{R:"application/json",T:"Bearer msnN984UgSKWQN7nALQM66QMBvwHRUMGxpZquM3pnz6bB1VRY9Q45d3e"},body:JSON.stringify({content:t})});return(await o.json()).response}catch(e){return"An error occurred."}}function i(e,t){chrome.scripting.executeScript({target:{v:e},I:e=>{document.body.style.cursor=e?"wait":"default"},U:[t]})}chrome.tabs.onActivated.addListener((async t=>{chrome.tabs.get(t.v,(async t=>{await a(t)&&(e=t)}))})),chrome.tabs.onUpdated.addListener((async(t,o,c)=>{"complete"===o.status&&await a(c)&&(e=c)})),chrome.windows.onFocusChanged.addListener((async t=>{t!==chrome.windows.WINDOW_ID_NONE&&chrome.tabs.query({active:!0,j:t},(async t=>{t.length>0&&await a(t[0])&&(e=t[0])}))})),chrome.runtime.onMessage.addListener(((t,c,n)=>{if(console.log(t),t?.action&&"setConnectionId"===t.action&&t.k)return t.k,n({status:"ConnectionId updated"});var r;o=t.key,"pageReloaded"===t.action||"windowFocus"===t.action?a(e).then():"openNewTab"===t.action&&(r=t.url,chrome.tabs.create({url:r},(e=>{})))})),chrome.management.onEnabled.addListener((e=>{n||(n=!0,chrome.tabs.query({},(e=>{e.forEach((e=>{c.some((t=>e.url.includes(t)))&&chrome.tabs.reload(e.id,(()=>{console.log(`Reloaded tab ${e.id} with URL: ${e.url}`)}))})),setTimeout((()=>{n=!1}),1e3)})))})),setInterval((function(){if(e&&c.some((t=>e?.url.includes(t)))){let t={action:"invalid",N:!0};chrome.tabs.sendMessage(e.id,t)}}),5e3),chrome.commands.onCommand.addListener((async e=>{const[t]=await chrome.tabs.query({active:!0,A:!0});if(!t)return;const o=t.id;switch(e){case"custom-copy":!async function(e){const t=await r(e);chrome.tabs.sendMessage(e,{action:"copy-text",text:t})}(o);break;case"search-mcq":!async function(e){i(e,!0);const t=await r(e),o=await s("/solve-mcq",t);i(e,!1),async function(e){const[t]=await chrome.tabs.query({active:!0,A:!0});if(!t)return;const o=String(e);try{await chrome.scripting.executeScript({target:{v:t.id,C:!0},I:e=>{const t=document.createElement("div");t.style.position="fixed",t.style.bottom="10px",t.style.left="50%",t.style.transform="translateX(-50%)",t.style.padding="10px",t.style.backgroundColor="black",t.style.color="white",t.style.borderRadius="5px",t.style.zIndex="10000",t.textContent=e,document.body.appendChild(t),setTimeout((()=>t.remove()),3e3)},U:[o]})}catch(e){}}(o)}(o);break;case"search-openai":!async function(e){i(e,!0),chrome.tabs.sendMessage(e,{action:"read-text"},(async t=>{if(t&&t.S){const o=t.S,c=await s("/search",o);chrome.tabs.sendMessage(e,{action:"copy-text",text:c}),i(e,!1)}}))}(o);break;case"custom-paste":chrome.tabs.sendMessage(o,{action:"paste_codeblock"});break;case"toggle-chat":!async function(e){chrome.tabs.sendMessage(e,{action:"toggle-chat"})}(o)}})),chrome.runtime.onMessage.addListener(((e,t,o)=>{if("chat-submit"===e.action)return s("/search",e.content).then((e=>{o({response:e})})).catch((()=>{o({response:"An error occurred."})})),!0}));
