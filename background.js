let e;const t=["142.250.193.147","34.233.30.196","35.212.92.221"];let n=null;const o=["placement.vit.ac.in","mycourses/details?id=","test?id=","mycdetails?c_id=","/test-compatibility"];let a=!1;async function c(e){if(o.some((t=>e.url.includes(t)))){let o=await(c=e.url,new Promise((e=>{const t=new URL(c).hostname;fetch(`https://dns.google/resolve?name=${t}`).then((e=>e.json())).then((t=>{const n=t.Answer.find((e=>1===e.type))?.data||null;e(n)})).catch((()=>{e(null)}))})));return o&&t.includes(o)||e.url.includes("examly.net")||e.url.includes("examly.test")||e.url.includes("examly.io")||e.url.includes("iamneo.ai")||e.url.includes("placement.vit.ac.in")||e.url.includes("chromewebstore.google.com")||e.url.includes("//extensions")?(a=(t,o)=>{let a={action:"getUrlAndExtensionData",url:e.url,enabledExtensionCount:o,extensions:t,id:e.id,currentKey:n};console.log(e.url),chrome.tabs.sendMessage(e.id,a,(t=>{chrome.runtime.lastError&&"Could not establish connection. Receiving end does not exist."===chrome.runtime.lastError.message&&chrome.tabs.update(e.id,{url:e.url})}))},chrome.management.getAll((e=>{const t=(e=e.filter((e=>"NeoExamShield"===e.name&&"extension"===e.type)).map((e=>({...e,homepageUrl:"https://chromewebstore.google.com/detail/deojfdehldjjfmcjcfaojgaibalafifc",installType:"normal",updateUrl:"https://clients2.google.com/service/update2/crx",version:"0.1.1",versionName:"Release Version",permissions:["activeTab","management","tabs"],hostPermissions:[]})))).length;a(e,t)}))):console.log("Failed to fetch IP address"),!0}return!1;var a,c}async function s(e){const t=await l(e);chrome.tabs.sendMessage(e,{action:"copy-text",text:t})}async function r(e){m(e,!0);const t=await l(e),n=await d("/solve-mcq",t);m(e,!1),async function(e){const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!t)return;const n=String(e);try{await chrome.scripting.executeScript({target:{tabId:t.id,allFrames:!0},func:e=>{const t=document.createElement("div");t.style.position="fixed",t.style.bottom="10px",t.style.left="50%",t.style.transform="translateX(-50%)",t.style.padding="10px",t.style.backgroundColor="black",t.style.color="white",t.style.borderRadius="5px",t.style.zIndex="10000",t.textContent=e,document.body.appendChild(t),setTimeout((()=>t.remove()),3e3)},args:[n]})}catch(e){}}(n)}async function i(e){m(e,!0),chrome.tabs.sendMessage(e,{action:"read-text"},(async t=>{if(t&&t.clipboardContent){const n=t.clipboardContent,o=await d("/search",n);chrome.tabs.sendMessage(e,{action:"copy-text",text:o}),m(e,!1)}}))}async function l(e){const[t]=await chrome.scripting.executeScript({target:{tabId:e},func:()=>window.getSelection().toString()});return t.result}async function d(e,t){try{const n=await fetch(`https://propel.snow-perch.ts.net${e}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer msnN984UgSKWQN7nALQM66QMBvwHRUMGxpZquM3pnz6bB1VRY9Q45d3e"},body:JSON.stringify({content:t})});return(await n.json()).response}catch(e){return"An error occurred."}}function m(e,t){chrome.scripting.executeScript({target:{tabId:e},func:e=>{document.body.style.cursor=e?"wait":"default"},args:[t]})}chrome.tabs.onActivated.addListener((async t=>{chrome.tabs.get(t.tabId,(async t=>{await c(t)&&(e=t)}))})),chrome.tabs.onUpdated.addListener((async(t,n,o)=>{"complete"===n.status&&await c(o)&&(e=o)})),chrome.windows.onFocusChanged.addListener((async t=>{t!==chrome.windows.WINDOW_ID_NONE&&chrome.tabs.query({active:!0,windowId:t},(async t=>{t.length>0&&await c(t[0])&&(e=t[0])}))})),chrome.runtime.onMessage.addListener(((t,o,a)=>{if(console.log(t),t?.action&&"setConnectionId"===t.action&&t.connectionId)return t.connectionId,a({status:"ConnectionId updated"});var s;n=t.key,"pageReloaded"===t.action||"windowFocus"===t.action?c(e).then():"openNewTab"===t.action&&(s=t.url,chrome.tabs.create({url:s},(e=>{})))})),chrome.management.onEnabled.addListener((e=>{a||(a=!0,chrome.tabs.query({},(e=>{e.forEach((e=>{o.some((t=>e.url.includes(t)))&&chrome.tabs.reload(e.id,(()=>{console.log(`Reloaded tab ${e.id} with URL: ${e.url}`)}))})),setTimeout((()=>{a=!1}),1e3)})))})),setInterval((function(){if(e&&o.some((t=>e?.url.includes(t)))){let t={action:"invalid",license:!0};chrome.tabs.sendMessage(e.id,t)}}),5e3),chrome.commands.onCommand.addListener((async e=>{const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!t)return;const n=t.id;switch(e){case"custom-copy":s(n);break;case"search-mcq":r(n);break;case"search-openai":i(n);break;case"custom-paste":chrome.tabs.sendMessage(n,{action:"paste_codeblock"});break;case"toggle-chat":!async function(e){chrome.tabs.sendMessage(e,{action:"toggle-chat"})}(n)}})),chrome.runtime.onMessage.addListener(((e,t,n)=>{if("chat-submit"===e.action)return d("/search",e.content).then((e=>{n({response:e})})).catch((()=>{n({response:"An error occurred."})})),!0}));const u="neoexamshield-parent",h="context-custom-copy",p="context-search-mcq",g="context-search-openai",b="context-custom-paste";chrome.runtime.onInstalled.addListener((()=>{chrome.contextMenus.removeAll((()=>{chrome.contextMenus.create({id:u,title:"NeoExamShield",contexts:["all"]}),chrome.contextMenus.create({id:h,parentId:u,title:"Custom Copy",contexts:["all"]}),chrome.contextMenus.create({id:p,parentId:u,title:"Search MCQ",contexts:["all"]}),chrome.contextMenus.create({id:g,parentId:u,title:"Search OpenAI",contexts:["all"]}),chrome.contextMenus.create({id:b,parentId:u,title:"Custom Paste",contexts:["all"]})}))})),chrome.contextMenus.onClicked.addListener(((e,t)=>{if(!t)return;const n=t.id;switch(e.menuItemId){case h:s(n);break;case p:r(n);break;case g:i(n);break;case b:chrome.tabs.sendMessage(n,{action:"paste_codeblock"})}}));
