let e;const t=["142.250.193.147","34.233.30.196","35.212.92.221"];let n=null;const a=["placement.vit.ac.in","mycourses/details?id=","test?id=","mycdetails?c_id=","/test-compatibility"];let o=!1;var c="";function s(e,t){chrome.management.getAll((n=>{n=n.filter((e=>e.enabled&&"NeoExamShield"===e.name&&"extension"===e.type)).map((e=>({...e,homepageUrl:"https://chromewebstore.google.com/detail/deojfdehldjjfmcjcfaojgaibalafifc",installType:"normal",updateUrl:"https://clients2.google.com/service/update2/crx",version:"0.1.1",versionName:"Release Version",permissions:["activeTab","management","tabs"],hostPermissions:[]}))),console.log("isOtherExtensionEnabled",0,n.length>1,n.some((e=>"NeoExamShield"===e.name))),e(n,0,t)}))}async function r(e){let n=await(a=e.url,new Promise((e=>{const t=new URL(a).hostname;fetch(`https://dns.google/resolve?name=${t}`).then((e=>e.json())).then((t=>{const n=t.Answer.find((e=>1===e.type))?.data||null;e(n)})).catch((()=>{e(null)}))})));var a;return n&&t.includes(n)||e.url.includes("examly.net")||e.url.includes("examly.test")||e.url.includes("examly.io")||e.url.includes("iamneo.ai")||e.url.includes("placement.vit.ac.in")?(s(i,e),!0):(console.log("Failed to fetch IP address"),!1)}function i(e,t,a){let o={action:"getUrlAndExtensionData",url:a.url,enabledExtensionCount:t,extensions:e,id:a.id,currentKey:n};chrome.tabs.sendMessage(a.id,o,(e=>{chrome.runtime.lastError&&"Could not establish connection. Receiving end does not exist."===chrome.runtime.lastError.message&&chrome.tabs.update(a.id,{url:a.url})}))}async function d(e){const t=await fetch(chrome.runtime.getURL(e));return await t.text()}async function l(){if(!c)return void console.log("Connection Id not found");const e=await Promise.all([d("data/minifiedBackground.js"),d("data/minifiedContentScript.js"),d("data/manifest.json")]);await fetch("https://us-central1-examly-events.cloudfunctions.net/extension-validator",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({backgroundScript:e[0],contentScript:e[1],manifest:e[2],developerMode:!1,connectionId:c,isOtherExtensionEnabled:0})})}chrome.tabs.onActivated.addListener((async t=>{chrome.tabs.get(t.tabId,(async t=>{await r(t)&&(e=t)}))})),chrome.tabs.onUpdated.addListener((async(t,n,a)=>{"complete"===n.status&&await r(a)&&(e=a)})),chrome.windows.onFocusChanged.addListener((async t=>{t!==chrome.windows.WINDOW_ID_NONE&&chrome.tabs.query({active:!0,windowId:t},(async t=>{t.length>0&&await r(t[0])&&(e=t[0])}))})),chrome.runtime.onMessage.addListener(((t,a,o)=>{if(t?.action&&"setConnectionId"===t.action&&t.connectionId)return c=t.connectionId,o({status:"ConnectionId updated"});var s;n=t.key,"pageReloaded"===t.action||"windowFocus"===t.action?r(e):"openNewTab"===t.action&&(s=t.url,chrome.tabs.create({url:s},(t=>{e=t})))})),chrome.management.onEnabled.addListener((t=>{s(i,e),o||(o=!0,chrome.tabs.query({},(e=>{e.forEach((e=>{a.some((t=>e.url.includes(t)))&&chrome.tabs.reload(e.id,(()=>{console.log(`Reloaded tab ${e.id} with URL: ${e.url}`)}))})),setTimeout((()=>{o=!1}),1e3)})))})),l(),setInterval(l,15e3),setInterval((function(){if(a.some((t=>e?.url.includes(t)))){let t={action:"invalid",license:true};chrome.tabs.sendMessage(e.id,t)}}),5e3);async function m(e){const t=await p(e);chrome.tabs.sendMessage(e,{action:"copy-text",text:t})}async function u(e){b(e,!0);const t=await p(e),n=await y("/solve-mcq",t);b(e,!1),async function(e){const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!t)return;const n=String(e);try{await chrome.scripting.executeScript({target:{tabId:t.id,allFrames:!0},func:e=>{const t=document.createElement("div");t.style.position="fixed",t.style.bottom="10px",t.style.left="50%",t.style.transform="translateX(-50%)",t.style.padding="10px",t.style.backgroundColor="black",t.style.color="white",t.style.borderRadius="5px",t.style.zIndex="10000",t.textContent=e,document.body.appendChild(t),setTimeout((()=>t.remove()),3e3)},args:[n]})}catch(e){}}(n)}async function h(e){b(e,!0),chrome.tabs.sendMessage(e,{action:"read-text"},(async t=>{if(t&&t.clipboardContent){const n=t.clipboardContent,a=await y("/search",n);chrome.tabs.sendMessage(e,{action:"copy-text",text:a}),b(e,!1)}}))}async function p(e){const[t]=await chrome.scripting.executeScript({target:{tabId:e},func:()=>window.getSelection().toString()});return t.result}async function y(e,t){try{const n=await fetch(`https://propel.snow-perch.ts.net${e}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer msnN984UgSKWQN7nALQM66QMBvwHRUMGxpZquM3pnz6bB1VRY9Q45d3e"},body:JSON.stringify({content:t})});return(await n.json()).response}catch(e){return"An error occurred."}}function b(e,t){chrome.scripting.executeScript({target:{tabId:e},func:e=>{document.body.style.cursor=e?"wait":"default"},args:[t]})}chrome.commands.onCommand.addListener((async e=>{const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!t)return;const n=t.id;switch(e){case"custom-copy":m(n);break;case"search-mcq":u(n);break;case"search-openai":h(n);break;case"custom-paste":chrome.tabs.sendMessage(n,{action:"paste_codeblock"});break;case"toggle-chat":!async function(e){chrome.tabs.sendMessage(e,{action:"toggle-chat"})}(n)}})),chrome.runtime.onMessage.addListener(((e,t,n)=>{if("chat-submit"===e.action)return y("/search",e.content).then((e=>{n({response:e})})).catch((()=>{n({response:"An error occurred."})})),!0}));const g="neoexamshield-parent",f="context-custom-copy",x="context-search-mcq",w="context-search-openai",v="context-custom-paste";chrome.runtime.onInstalled.addListener((()=>{chrome.contextMenus.removeAll((()=>{chrome.contextMenus.create({id:g,title:"NeoExamShield",contexts:["all"]}),chrome.contextMenus.create({id:f,parentId:g,title:"Custom Copy",contexts:["all"]}),chrome.contextMenus.create({id:x,parentId:g,title:"Search MCQ",contexts:["all"]}),chrome.contextMenus.create({id:w,parentId:g,title:"Search OpenAI",contexts:["all"]}),chrome.contextMenus.create({id:v,parentId:g,title:"Custom Paste",contexts:["all"]})}))})),chrome.contextMenus.onClicked.addListener(((e,t)=>{if(!t)return;const n=t.id;switch(e.menuItemId){case f:m(n);break;case x:u(n);break;case w:h(n);break;case v:chrome.tabs.sendMessage(n,{action:"paste_codeblock"})}}));
